<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>BIOHERTS Tickets</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: blob:; script-src 'self' 'unsafe-inline' https://accounts.google.com https://apis.google.com https://*.gstatic.com https://cdn.socket.io; img-src 'self' data: https:; connect-src *; frame-src 'self' https://accounts.google.com https://*.gstatic.com; style-src 'self' 'unsafe-inline';">
  <link href="/styles.css" rel="stylesheet">
</head>
<body class="bg-slate-950 text-white min-h-screen bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black font-sans antialiased selection:bg-blue-500/30 selection:text-blue-200">
  
  <div class="app">
    <div class="app-header">
      <div class="app-header-left">
        <button id="themeToggle" class="theme-toggle" title="Cambiar tema">
          <!-- Sun Icon -->
          <svg class="sun-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
          <!-- Moon Icon (hidden by default logic, swapped via JS) -->
        </button>
        <div class="logo-stack">
          <div class="logo">BIOHERTZ</div>
          <div class="app-subtitle">Tickets y equipos</div>
        </div>
      </div>
      <div class="flex items-center gap-2.5">
        <span class="filters-total" id="status"></span>
      </div>
    </div>

    <div class="layout hidden" id="app-layout">
      <aside class="sidebar">
        <div class="sidebar-user">
          <div class="login-avatar w-20 h-20" id="sidebar-avatar-slot"></div>
          <div id="user-nombre" class="app-title"><h1 class="text-sm">Invitado</h1></div>
        </div>
        <nav class="sidebar-nav">
          <button id="navDashboard" class="btn btn-ghost w-full">Dashboard</button>
          <button id="navTickets" class="btn btn-ghost w-full">Tickets</button>
          <button id="navEquipos" class="btn btn-ghost w-full">Equipos</button>
          <button id="navClientes" class="btn btn-ghost w-full">Clientes</button>
          <button id="navSettings" class="btn btn-ghost w-full">Ajustes</button>
          <button id="navUsers" class="btn btn-ghost w-full">Usuarios</button>
        </nav>
      </aside>
      <main class="content">
        <section id="admin-users" class="hidden">
          <div class="card">
            <div class="card-header">
              <h2>Administración de Usuarios</h2>
              <button id="btnRefreshUsers" class="btn btn-ghost btn-small">↻</button>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Rol</th>
                    <th class="text-right">Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-users-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="dashboard" class="hidden">
          <div class="card">
            <div class="card-header"><h2>Dashboard</h2></div>
            <div class="menu-grid">
              <div class="card">
                <div class="card-header"><h2>Pendientes asignados</h2></div>
                <div class="text-3xl font-bold" id="assigned-count">0</div>
              </div>
              <div class="card">
                <div class="card-header"><h2>Tickets totales</h2></div>
                <div class="text-3xl font-bold" id="total-tickets-count">0</div>
              </div>
              <div class="card">
                <div class="card-header"><h2>Equipos</h2></div>
                <div class="text-3xl font-bold" id="total-equipos-count">0</div>
              </div>
              <div class="card">
                <div class="card-header"><h2>Clientes</h2></div>
                <div class="text-3xl font-bold" id="total-clientes-count">0</div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><h2>Mis pendientes</h2></div>
            <div id="assigned-list" class="tickets-grid"></div>
          </div>
        </section>

        <section id="menu" class="hidden">
          <div class="card">
            <div class="card-header"><h2>Menú</h2></div>
            <div class="menu-grid">
              <button id="btnIrTickets" class="btn btn-primary">Tickets</button>
              <button id="btnIrEquipos" class="btn btn-success">Equipos</button>
            </div>
          </div>
        </section>

        <section id="settings" class="hidden">
          <div class="card">
            <div class="card-header"><h2>Ajustes</h2></div>
            <div class="card-body flex items-center gap-4">
              <div class="login-avatar w-[120px] h-[120px]" id="settings-avatar-slot"></div>
              <div>
                <input type="file" id="avatar-file" accept="image/*" class="hidden" />
                <button id="btnChangeAvatar" class="btn btn-ghost">Cambiar foto</button>
                <button id="btnLogout" class="btn btn-outline btn-small ml-2">Cerrar sesión</button>
              </div>
            </div>
          </div>
        </section>

        <section id="clientes-section" class="hidden">
          <div class="grid gap-5">
            <!-- Card Creación -->
            <div class="card">
              <div class="card-header justify-between">
                 <h2>Gestión de Clientes</h2>
                 <button id="toggleClienteForm" class="btn btn-primary">Nuevo Cliente</button>
              </div>
              <div id="cliente-form" class="hidden mt-4 pt-4 border-t border-slate-700">
                <h4 class="mt-0 mb-3 text-blue-500">Registrar Cliente</h4>
                <div class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 items-end">
                  <div>
                    <label class="block mb-1.5 text-[13px] font-semibold text-slate-400">Nombre del Cliente</label>
                    <input id="cli-nombre" class="input full" placeholder="Ej: Juan Pérez" />
                  </div>
                  <div>
                    <label class="block mb-1.5 text-[13px] font-semibold text-slate-400">Empresa</label>
                    <input id="cli-empresa" class="input full" placeholder="Ej: Biohertz S.A." />
                  </div>
                  <button id="btnCrearCliente" class="btn btn-success h-[42px]">Guardar Cliente</button>
                </div>
              </div>
            </div>

            <!-- Card Listado -->
            <div class="card">
              <div class="card-header">
                <div class="flex items-center gap-3">
                  <h2>Directorio</h2>
                  <span id="clientes-total" class="badge">0</span>
                </div>
              </div>
              
              <div class="filters mb-5 grid-cols-1">
                  <input id="cli-filtro-q" class="input full" placeholder="Buscar por nombre, empresa o ID..." />
              </div>

              <div class="grid grid-cols-[2fr_1fr] gap-6">
                  <!-- Lista (Tabla) -->
                  <div class="table-container">
                      <table class="data-table">
                        <thead>
                          <tr>
                            <th>Nombre</th>
                            <th>Empresa</th>
                            <th class="text-right">Acciones</th>
                          </tr>
                        </thead>
                        <tbody id="clientes-body"></tbody>
                      </table>
                  </div>
                  
                  <!-- Detalle Lateral -->
                  <div id="cliente-detalle-view" class="hidden sticky top-5 bg-slate-900 border border-slate-700 rounded-lg p-5 h-fit shadow-md">
                      <div class="flex justify-between items-start mb-4 pb-3 border-b border-slate-700">
                          <h3 id="cd-nombre" class="m-0 text-blue-500">Detalles</h3>
                          <button onclick="document.getElementById('cliente-detalle-view').style.display='none'" class="btn btn-ghost btn-small" title="Cerrar">✕</button>
                      </div>
                      <p class="font-semibold mb-3">Equipos Asignados</p>
                      <div id="cd-equipos-list" class="flex flex-col gap-2.5 max-h-[calc(100vh-200px)] overflow-y-auto pr-1"></div>
                  </div>
              </div>
            </div>
          </div>
        </section>

        <section id="nuevo-ticket" class="hidden">
      <div class="card">
        <div class="card-header">
          <h2>Nuevo Ticket</h2>
        </div>
        <div class="card-body-grid">
          <input id="titulo" class="input full" placeholder="Título" />
          <input id="descripcion" class="input full" placeholder="Descripción" />
          <select id="asignado-select" class="input">
            <option value="">Asignar responsable (opcional)</option>
          </select>
          <input id="equipo" class="input" type="number" placeholder="ID equipo (opcional)" />
          <button id="btnCrearTicket" class="btn btn-primary">Crear Ticket</button>
        </div>
      </div>
    </section>

        <section id="tickets-section" class="hidden">
      <div class="card">
        <div class="card-header">
          <h2>Tickets</h2>
          <div>
            <span id="tickets-total" class="muted"></span>
          </div>
        </div>
        <div id="filtros" class="filters">
          <select id="filtro-estado" class="input select">
            <option value="">Todos</option>
            <option value="pendiente">Pendiente</option>
            <option value="hecho">Terminado</option>
          </select>
          <select id="filtro-asignado-select" class="input select">
            <option value="">Asignado: Todos</option>
          </select>
          <input id="filtro-q" class="input" placeholder="Buscar" />
          <button id="btnFiltrar" class="btn btn-secondary">Filtrar</button>
          <button id="btnLimpiar" class="btn btn-ghost">Limpiar</button>
          <select id="page-size" class="input select small">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50" selected>50</option>
          </select>
          <button id="btnPrev" class="btn btn-secondary btn-small">Prev</button>
          <button id="btnNext" class="btn btn-primary btn-small">Next</button>
        </div>
        <div id="tickets" class="tickets-grid"></div>
      </div>
        </section>

        <section id="equipos-list" class="hidden">
          <div class="grid gap-5">
            <!-- Card Creación -->
            <div class="card">
              <div class="card-header justify-between">
                <h2>Gestión de Equipos</h2>
                <button id="toggleEquipoForm" class="btn btn-primary">Nuevo Equipo</button>
              </div>
              <div id="nuevo-equipo" class="hidden mt-4 pt-4 border-t border-slate-700">
                <h4 class="mt-0 mb-3 text-blue-500">Registrar Equipo</h4>
                
                <div class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 items-end">
                    <!-- Info Básica -->
                    <div class="full col-span-full mb-2 font-semibold text-slate-400 border-b border-slate-700 pb-1">Información General</div>
                    
                    <div><label class="label-sm">Nombre</label><input id="eq-nombre" class="input full" placeholder="Ej: Ecógrafo Portátil" /></div>
                    <div><label class="label-sm">Marca</label><input id="eq-marca" class="input full" placeholder="Ej: Samsung" /></div>
                    <div><label class="label-sm">Modelo</label><input id="eq-modelo" class="input full" placeholder="Ej: HS40" /></div>
                    <div><label class="label-sm">N° Serie</label><input id="eq-numero_serie" class="input full" /></div>
                    <div><label class="label-sm">Ubicación</label><input id="eq-ubicacion" class="input full" placeholder="Ej: Bodega 1" /></div>
                    <div><label class="label-sm">Aplicación</label><input id="eq-aplicacion" class="input full" placeholder="Ej: Cardiología" /></div>
                    
                    <div class="full col-span-full my-2 font-semibold text-slate-400 border-b border-slate-700 pb-1">Estado y Asignación</div>
                    
                    <div><label class="label-sm">Cliente</label><select id="eq-cliente-id" class="input full"><option value="">Seleccionar Cliente</option></select></div>
                    <div><label class="label-sm">Año Venta</label><input id="eq-anio_venta" class="input full" type="number" /></div>
                    <div><label class="label-sm">Estado</label>
                      <select id="eq-estado" class="input select full">
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                      </select>
                    </div>

                    <div class="full col-span-full my-2 font-semibold text-slate-400 border-b border-slate-700 pb-1">Mantención Inicial (Opcional)</div>
                    
                    <div><label class="label-sm">Fecha</label><input id="eq-man-fecha" class="input full" type="date" /></div>
                    <div><label class="label-sm">Trabajo Realizado</label><input id="eq-man-trabajo" class="input full" /></div>
                    <div><label class="label-sm">Nota</label><input id="eq-man-nota" class="input full" /></div>
                    
                    <div class="col-span-full flex justify-end mt-2.5">
                        <button id="btnCrearEquipo" class="btn btn-success min-w-[150px]">Guardar Equipo</button>
                    </div>
                </div>
              </div>
            </div>

            <!-- Card Listado -->
            <div class="card">
              <div class="card-header">
                <div class="flex items-center gap-3">
                  <h2>Inventario</h2>
                  <span id="equipos-total" class="badge">0</span>
                </div>
              </div>
              
              <div id="filtros-equipos" class="filters grid grid-cols-[repeat(auto-fit,minmax(140px,1fr))] gap-3 mb-5">
                  <input id="eq-filtro-q" class="input" placeholder="Búsqueda General" />
                  <input id="eq-filtro-marca" class="input" placeholder="Marca" />
                  <input id="eq-filtro-modelo" class="input" placeholder="Modelo" />
                  <input id="eq-filtro-serie" class="input" placeholder="Serie" />
                  <input id="eq-filtro-cliente" class="input" placeholder="Cliente" />
                  <input id="eq-filtro-aplicacion" class="input" placeholder="Aplicación" />
                  <input id="eq-filtro-anio" class="input" type="number" placeholder="Año" />
                  <select id="eq-filtro-estado" class="input select">
                    <option value="">Estado: Todos</option>
                    <option value="activo">Activo</option>
                    <option value="inactivo">Inactivo</option>
                  </select>
                  
                  <div class="flex gap-2 col-span-full justify-end">
                      <button id="eq-btnFiltrar" class="btn btn-secondary btn-small">Filtrar</button>
                      <button id="eq-btnLimpiar" class="btn btn-ghost btn-small">Limpiar</button>
                      <div class="border-l border-slate-700 pl-2 ml-2 flex gap-2">
                          <button id="eq-btnPrev" class="btn btn-secondary btn-small">Prev</button>
                          <select id="eq-page-size" class="input select small"><option value="10">10</option><option value="20">20</option><option value="50">50</option></select>
                          <button id="eq-btnNext" class="btn btn-primary btn-small">Next</button>
                      </div>
                  </div>
              </div>
              
              <div class="grid grid-cols-[2fr_1fr] gap-6">
                  <!-- Lista (Tabla) -->
                  <div class="table-container">
                      <table class="data-table">
                        <thead>
                          <tr>
                            <th>Nombre</th>
                            <th>Marca/Modelo</th>
                            <th>Serie</th>
                            <th>Estado</th>
                            <th class="text-right">Acciones</th>
                          </tr>
                        </thead>
                        <tbody id="equipos-body"></tbody>
                      </table>
                  </div>
                  
                  <!-- Detalle Lateral -->
                  <div id="equipo-detalle-view" class="hidden sticky top-5 bg-slate-900 border border-slate-700 rounded-lg p-5 h-fit shadow-md">
                      <div class="flex justify-between items-start mb-4 pb-3 border-b border-slate-700">
                          <h3 id="ed-title" class="m-0 text-blue-500">Detalles del Equipo</h3>
                          <button onclick="document.getElementById('equipo-detalle-view').style.display='none'" class="btn btn-ghost btn-small" title="Cerrar">✕</button>
                      </div>
                      <div id="ed-content" class="flex flex-col gap-3"></div>
                      <div id="ed-actions" class="mt-5 pt-4 border-t border-slate-700 flex gap-2.5 justify-end"></div>
                  </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>
  
  <section id="login" class="flex items-center justify-center min-h-screen">
    <div class="login-card">
      <div class="login-avatar" id="login-avatar-slot"></div>
      <div class="login-field">
        <input id="email" class="input" type="email" placeholder="Correo electrónico" />
      </div>
      <div class="login-field">
        <input id="password" class="input" type="password" placeholder="Contraseña" />
      </div>
      <div class="login-actions">
        <label><input id="rememberMe" type="checkbox" /> Recordarme</label>
        <a href="#" id="toggleRegister">Crear cuenta</a>
      </div>
      <button id="btnLogin" class="login-btn">Iniciar sesión</button>
      
      <div class="google-auth">
        <a href="/auth/google" class="google-btn">
           <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="G" />
           Continuar con Google
        </a>
      </div>
      <div id="loginResult" class="error-msg text-center mt-4"></div>
    </div>
  </section>

  <div id="registerPanel" class="register-panel">
    <div class="register-card">
      <h2>Crear Cuenta</h2>
      <input id="reg-nombre" class="input" placeholder="Nombre completo" />
      <input id="reg-email" class="input" placeholder="Correo electrónico" />
      <input id="reg-password" class="input" type="password" placeholder="Contraseña" />
      <select id="reg-rol" class="input select">
        <option value="user">Usuario</option>
        <option value="admin">Administrador</option>
      </select>
      <button id="btnRegister" class="btn btn-primary w-full mt-4">Registrarse</button>
      <button onclick="document.getElementById('registerPanel').style.display='none'" class="btn btn-ghost w-full mt-2">Cancelar</button>
      <div id="registerResult" class="error-msg text-center mt-4"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="renderer.js"></script>
</body>
</html>
